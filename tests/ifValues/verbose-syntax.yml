service: my-service

provider:
  name: aws
  stage: ${opt:stage, 'dev'}
  region: ${opt:region, 'us-east-1'}

custom:
  # Different memory by stage
  memorySize: '${if(${provider.stage} === "prod" ? 1024 : 512)}'

  # Different log retention by stage
  logRetention: '${if(("${provider.stage}" === "prod") ? 30 : 7)}'

  # Enable features per environment
  enableDebugEndpoints: '${if("${provider.stage}" !== "prod")}'
  enableMetrics: '${if("${provider.stage}" === "prod")}'

  # Regional settings
  replicaCount: '${if(("${provider.region}" === "us-east-1") ? 3 : 1)}'

  # Conditional IAM role (use predefined role in prod, inline in dev)
  useExternalRole: '${if("${provider.stage}" === "prod")}'
  role: '${if((${custom.useExternalRole}) ? "arn:aws:iam::123:role/prod-role" : null)}'

functions:
  api:
    handler: handler.api
    memorySize: ${custom.memorySize}

  # Debug function - only deployed in non-prod
  debug:
    handler: handler.debug
    enabled: ${custom.enableDebugEndpoints}

  # Metrics processor - only in prod
  metricsProcessor:
    handler: handler.metrics
    enabled: ${custom.enableMetrics}
